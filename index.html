<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<title>VidStream Pro</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg-main:#060b14;
  --bg-card:#131b2e;
  --accent:#2563eb;
  --text:#fff;
  --muted:#94a3b8;
  --border:#1e293b;
}
body{
  margin:0;
  background:var(--bg-main);
  color:var(--text);
  font-family:Inter,sans-serif;
}
a{text-decoration:none;color:inherit}
.container{max-width:1100px;margin:auto;padding:0 20px}

.navbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px 0;
  border-bottom:1px solid var(--border)
}
.brand{font-weight:800;font-size:20px}
.brand span{color:var(--accent)}

.hero{
  padding:30px 0;
  border-bottom:1px solid var(--border)
}
.hero h1{margin:0 0 6px;font-size:28px}
.hero p{margin:0;color:var(--muted);font-size:14px}

.gallery-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:15px;
  margin-top:20px
}

.vid-card{
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:10px;
  overflow:hidden;
  transition:.2s
}
.vid-card:hover{
  transform:translateY(-4px);
  border-color:var(--accent)
}

.thumb-area{
  position:relative;
  width:100%;
  aspect-ratio:16/9;
  background:#000 center/cover no-repeat;
  overflow:hidden
}
.thumb-area::after{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.15);
  z-index:2
}

/* VIDEO PREVIEW */
.thumb-video{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  z-index:1
}

.play-icon{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:3
}
.play-icon svg{
  width:46px;
  height:46px;
  background:rgba(255,255,255,.2);
  border-radius:50%;
  padding:12px;
  fill:#fff
}

.card-info{padding:12px}
.badge{
  font-size:10px;
  background:#1e3a8a;
  color:#93c5fd;
  padding:2px 6px;
  border-radius:4px;
  font-weight:700
}
.vid-title{
  font-size:13px;
  font-weight:600;
  margin:6px 0 0;
  line-height:1.4
}

.footer{
  margin:40px 0 20px;
  text-align:center;
  color:#555;
  font-size:12px
}
</style>
</head>

<body>
<div class="container">

  <div class="navbar">
    <div class="brand">VidStream<span>Pro</span></div>
    <div style="font-size:12px;color:#aaa;cursor:pointer" onclick="location.reload()">Refresh</div>
  </div>

  <div class="hero">
    <h1>Trending Videos</h1>
    <p>Koleksi video viral terbaru update harian.</p>
  </div>

  <div id="statusMsg" style="padding:20px;text-align:center;color:#aaa">
    Loading videos...
  </div>

  <div class="gallery-grid" id="gridTarget"></div>

  <div class="footer">
    Â© 2024 VidStream Pro
  </div>

</div>

<script>
async function loadVideos(){
  const grid=document.getElementById('gridTarget');
  const status=document.getElementById('statusMsg');

  try{
    const res=await fetch('videos.txt?t='+Date.now());
    if(!res.ok) throw new Error();
    const txt=await res.text();
    const lines=txt.split('\n');

    let html='';
    let count=0;

    lines.forEach(l=>{
      if(l.trim().length<3) return;

      const p=l.split('|');
      const id=p[0].trim();
      const title=p[1]?p[1].trim():'Video';

      const isDM=(id.length>9||id.startsWith('k'));
      const badge=isDM?'DM':'VIDEY';

      if(isDM){
        const thumb=`https://www.dailymotion.com/thumbnail/video/${id}`;
        html+=`
        <a href="?id=${id}" class="vid-card">
          <div class="thumb-area" style="background-image:url('${thumb}')">
            <div class="play-icon">
              <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </div>
          </div>
          <div class="card-info">
            <span class="badge">${badge}</span>
            <p class="vid-title">${title}</p>
          </div>
        </a>`;
      }else{
        const mp4=`https://cdn.videy.co/${id}.mp4`;
        html+=`
        <a href="?id=${id}" class="vid-card">
          <div class="thumb-area">
            <video class="thumb-video"
              src="${mp4}"
              muted
              playsinline
              preload="metadata"></video>
            <div class="play-icon">
              <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </div>
          </div>
          <div class="card-info">
            <span class="badge">${badge}</span>
            <p class="vid-title">${title}</p>
          </div>
        </a>`;
      }
      count++;
    });

    if(count){
      grid.innerHTML=html;
      status.style.display='none';
      initGridPreview();
    }else{
      status.textContent='No videos';
    }

  }catch(e){
    status.textContent='ERROR loading videos';
  }
}

/* === PREVIEW VIDEO 2 DETIK SAJA === */
function initGridPreview(){
  const vids=document.querySelectorAll('.thumb-video');

  const io=new IntersectionObserver(entries=>{
    entries.forEach(e=>{
      const v=e.target;
      if(e.isIntersecting){
        v.currentTime=0;
        v.play().catch(()=>{});

        if(v._timer) clearTimeout(v._timer);
        v._timer=setTimeout(()=>{
          v.pause();
          v.currentTime=0;
        },2000); // 2 DETIK
      }else{
        v.pause();
        v.currentTime=0;
        if(v._timer) clearTimeout(v._timer);
      }
    });
  },{threshold:0.4});

  vids.forEach(v=>io.observe(v));
}

loadVideos();
</script>

</body>
</html>
